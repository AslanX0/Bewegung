<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asia - All you can Eat | Restaurant Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- ========== HEADER ========== -->
    <header class="header">
        <div class="brand">
            <div class="brand-logo"><span class="mi">restaurant</span></div>
            <div>
                <h1>Asia - All you can Eat</h1>
                <span>Restaurant Management System</span>
            </div>
        </div>
        <div class="status">
            <div id="clock" style="font-size:1.1rem;font-weight:500">--:--</div>
            <div class="status-pill">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">Verbunden</span>
            </div>
        </div>
    </header>

    <!-- ========== NAVIGATION ========== -->
    <nav class="nav">
        <div class="tabs">
            <button class="tab active" data-tab="dashboard"><span class="mi">dashboard</span> Uebersicht</button>
            <button class="tab" data-tab="occupancy"><span class="mi">groups</span> Gaeste &amp; Klima</button>
            <button class="tab" data-tab="sensors"><span class="mi">thermostat</span> Sensoren</button>
            <button class="tab" data-tab="history"><span class="mi">history</span> Verlauf</button>
        </div>
    </nav>

    <main class="main">

        <!-- ========== TAB: UEBERSICHT ========== -->
        <div id="dashboard" class="content active">
            <!-- 4 Stat-Karten -->
            <div class="grid4">
                <div class="stat guests">
                    <div class="stat-icon"><span class="mi">groups</span></div>
                    <div class="stat-label">Aktuelle Gaeste</div>
                    <div class="stat-value" id="dGuests">--</div>
                    <div class="stat-sub" id="dGuestsSub">von max. 120 Plaetzen</div>
                </div>
                <div class="stat climate">
                    <div class="stat-icon"><span class="mi">ac_unit</span></div>
                    <div class="stat-label">Klimaanlage</div>
                    <div class="stat-value">Stufe <span id="dAC">3</span></div>
                    <div class="stat-sub good" id="dACSub">Optimal</div>
                </div>
                <div class="stat comfort">
                    <div class="stat-icon"><span class="mi">thermostat</span></div>
                    <div class="stat-label">Temperatur</div>
                    <div class="stat-value" id="dTemp">--<span class="unit">°C</span></div>
                    <div class="stat-sub good" id="dTempSub">Angenehm</div>
                </div>
                <div class="stat air">
                    <div class="stat-icon"><span class="mi">air</span></div>
                    <div class="stat-label">Luftqualitaet</div>
                    <div class="stat-value" id="dAir">Gut</div>
                    <div class="stat-sub good" id="dAirSub">Frische Luft</div>
                </div>
            </div>

            <!-- Chart + Tagesstatistik -->
            <div class="grid2">
                <div class="card">
                    <div class="card-head">
                        <span class="card-title"><span class="mi">show_chart</span> Gaesteentwicklung heute</span>
                        <div class="range">
                            <button class="range-btn active" data-dr="24">24h</button>
                            <button class="range-btn" data-dr="48">48h</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-box"><canvas id="dashChart"></canvas></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-head">
                        <span class="card-title"><span class="mi">analytics</span> Tagesstatistik (24h)</span>
                    </div>
                    <div class="card-body">
                        <ul class="sum-list">
                            <li><span class="l">Durchschn. Gaeste</span><span class="v" id="dAvgG">-- Pers.</span></li>
                            <li><span class="l">Max. Gaeste</span><span class="v" id="dMaxG">-- Pers.</span></li>
                            <li><span class="l">Durchschn. Temperatur</span><span class="v" id="dAvgT">-- °C</span></li>
                            <li><span class="l">Max. Temperatur</span><span class="v" id="dMaxT">-- °C</span></li>
                            <li><span class="l">Min. Temperatur</span><span class="v" id="dMinT">-- °C</span></li>
                            <li><span class="l">Durchschn. Feuchtigkeit</span><span class="v" id="dAvgH">-- %</span></li>
                            <li><span class="l">Bewegungserkennungen</span><span class="v" id="dMotCount">--</span></li>
                            <li><span class="l">Gesamt-Messungen</span><span class="v" id="dReadings">--</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="footer">Letzte Aktualisierung: <span id="lastUpd">--</span> – Auto-Update alle 30s</div>
        </div>

        <!-- ========== TAB: GAESTE & KLIMA ========== -->
        <div id="occupancy" class="content">
            <div class="hero">
                <div class="gauge-wrap">
                    <svg viewBox="0 0 180 180" width="180" height="180">
                        <circle class="gauge-bg" cx="90" cy="90" r="75"/>
                        <circle class="gauge-fill" id="gauge" cx="90" cy="90" r="75"
                                stroke-dasharray="471" stroke-dashoffset="471"/>
                    </svg>
                    <div class="gauge-center">
                        <div class="gauge-pct" id="gPct">--%</div>
                        <div class="gauge-lbl">Auslastung</div>
                    </div>
                </div>
                <div class="main-disp">
                    <div class="lbl">Geschaetzte Gaeste</div>
                    <div class="val" id="occVal">--</div>
                    <div class="sub">von 120 Sitzplaetzen</div>
                </div>
                <div class="ac-panel">
                    <div class="lbl">Klimaanlage Empfehlung</div>
                    <div class="ac-lvls">
                        <div class="ac-lvl" data-l="1">1</div>
                        <div class="ac-lvl" data-l="2">2</div>
                        <div class="ac-lvl cur" data-l="3">3</div>
                        <div class="ac-lvl" data-l="4">4</div>
                        <div class="ac-lvl" data-l="5">5</div>
                    </div>
                    <div class="ac-stat ok" id="acStat">Stufe 3 ist optimal</div>
                </div>
            </div>

            <div class="qstats">
                <div class="qstat">
                    <div class="qstat-icon t"><span class="mi">thermostat</span></div>
                    <div><div class="qstat-lbl">Temperatur</div><div class="qstat-val" id="oTemp">--°C</div></div>
                </div>
                <div class="qstat">
                    <div class="qstat-icon h"><span class="mi">water_drop</span></div>
                    <div><div class="qstat-lbl">Luftfeuchtigkeit</div><div class="qstat-val" id="oHum">--%</div></div>
                </div>
                <div class="qstat">
                    <div class="qstat-icon a"><span class="mi">air</span></div>
                    <div><div class="qstat-lbl">Luftqualitaet</div><div class="qstat-val" id="oGas">--</div></div>
                </div>
                <div class="qstat">
                    <div class="qstat-icon m"><span class="mi">sensors</span></div>
                    <div><div class="qstat-lbl">Aktivitaet (5 Min)</div><div class="qstat-val" id="oMot">--</div></div>
                </div>
            </div>

            <div class="card">
                <div class="card-head">
                    <span class="card-title"><span class="mi">show_chart</span> Gaesteverlauf</span>
                    <div class="range">
                        <button class="range-btn active" data-or="24">24h</button>
                        <button class="range-btn" data-or="48">48h</button>
                        <button class="range-btn" data-or="168">7d</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-box"><canvas id="occChart"></canvas></div>
                </div>
            </div>
        </div>

        <!-- ========== TAB: SENSOREN ========== -->
        <div id="sensors" class="content">
            <div class="grid3">
                <div class="sensor">
                    <div class="sensor-icon t"><span class="mi">thermostat</span></div>
                    <div class="sensor-name">Temperatur</div>
                    <div class="sensor-val" id="sTemp">--<span class="unit">°C</span></div>
                    <div class="sensor-stat good" id="sTempS">Angenehm</div>
                </div>
                <div class="sensor">
                    <div class="sensor-icon h"><span class="mi">water_drop</span></div>
                    <div class="sensor-name">Luftfeuchtigkeit</div>
                    <div class="sensor-val" id="sHum">--<span class="unit">%</span></div>
                    <div class="sensor-stat good" id="sHumS">Optimal</div>
                </div>
                <div class="sensor">
                    <div class="sensor-icon p"><span class="mi">speed</span></div>
                    <div class="sensor-name">Luftdruck</div>
                    <div class="sensor-val" id="sPres">--<span class="unit">hPa</span></div>
                    <div class="sensor-stat good">Normal</div>
                </div>
                <div class="sensor">
                    <div class="sensor-icon g"><span class="mi">air</span></div>
                    <div class="sensor-name">Luftqualitaet</div>
                    <div class="sensor-val" id="sGas">--<span class="unit">kOhm</span></div>
                    <div class="sensor-stat good" id="sGasS">Frisch</div>
                </div>
                <div class="sensor">
                    <div class="sensor-icon m"><span class="mi">sensors</span></div>
                    <div class="sensor-name">Bewegung</div>
                    <div class="sensor-val" id="sMot">--</div>
                    <div class="sensor-stat" id="sMotS">Keine Bewegung</div>
                </div>
            </div>

            <div class="grid2">
                <div class="card">
                    <div class="card-head">
                        <span class="card-title"><span class="mi">show_chart</span> Temperatur &amp; Feuchtigkeit</span>
                        <div class="range">
                            <button class="range-btn active" data-sr="24">24h</button>
                            <button class="range-btn" data-sr="48">48h</button>
                            <button class="range-btn" data-sr="168">7d</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-box"><canvas id="thChart"></canvas></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-head">
                        <span class="card-title"><span class="mi">analytics</span> 24h Statistik</span>
                    </div>
                    <div class="card-body">
                        <ul class="sum-list">
                            <li><span class="l">Durchschn. Temperatur</span><span class="v" id="sAvgT">-- °C</span></li>
                            <li><span class="l">Max. Temperatur</span><span class="v" id="sMaxT">-- °C</span></li>
                            <li><span class="l">Min. Temperatur</span><span class="v" id="sMinT">-- °C</span></li>
                            <li><span class="l">Durchschn. Feuchtigkeit</span><span class="v" id="sAvgH">-- %</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== TAB: VERLAUF ========== -->
        <div id="history" class="content">
            <div class="card">
                <div class="card-head">
                    <span class="card-title"><span class="mi">history</span> Messverlauf</span>
                    <div style="display:flex;gap:12px">
                        <button class="btn btn-sec" onclick="exportCSV()">
                            <span class="mi">download</span> Export
                        </button>
                        <button class="btn btn-primary" onclick="refreshTable()">
                            <span class="mi">refresh</span> Aktualisieren
                        </button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Zeitpunkt</th>
                            <th>Gaeste</th>
                            <th>Klima</th>
                            <th>Temp.</th>
                            <th>Feucht.</th>
                            <th>Druck</th>
                            <th>Bewegung</th>
                            <th>Quelle</th>
                        </tr>
                    </thead>
                    <tbody id="tBody"></tbody>
                </table>
                <div class="pag">
                    <span class="pag-info" id="pagInfo">Zeige 1-20 von -- Eintraegen</span>
                    <div class="pag-btns">
                        <button class="pg-btn" id="prevP" disabled>&lt;</button>
                        <button class="pg-btn" id="nextP">&gt;</button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <div class="toast-box" id="toasts"></div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
